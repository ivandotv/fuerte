var t=require("mobx"),e=require("@fuerte/core");function o(){return o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},o.apply(this,arguments)}function n(t,e){return n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}exports.AutosaveCollection=/*#__PURE__*/function(e){var a,i;function r(t,n,a){var i;return(i=e.call(this,t,n,a)||this).identityReactionByCid=new Map,i.saveReactionByCid=new Map,i.config.autoSave=o({enabled:!1,debounce:0},null!=a&&a.autoSave?a.autoSave:void 0),i}i=e,(a=r).prototype=Object.create(i.prototype),a.prototype.constructor=a,n(a,i);var c=r.prototype;return c.getConfig=function(){return e.prototype.getConfig.call(this)},c.startTracking=function(t){e.prototype.startTracking.call(this,t),this.config.autoSave.enabled&&this.startAutoSave(t)},c.stopTracking=function(t){e.prototype.stopTracking.call(this,t);var o=this.identityReactionByCid.get(t.cid);o&&o(),this.stopAutoSave(t)},c.autoSave=function(t){this.save(t.model)},c.startAutoSave=function(e){var o=this,n=e?Array.isArray(e)?e:[e]:this._models,a=[];return n.forEach(function(e){var n,i,r;if(!o.saveReactionByCid.get(e.cid)){a.push(e);var c=t.reaction(function(){return{model:e,data:e.payload}},o.config.autoSave.debounce?(n=o.autoSave.bind(o),i=o.config.autoSave.debounce,function(t,e,o){clearTimeout(r),r=setTimeout(function(){return n(t,e,o)},i)}):o.autoSave.bind(o),{name:"save-"+e.cid});o.saveReactionByCid.set(e.cid,c)}}),a.length&&this.onStartAutoSave(a),!e||Array.isArray(e)?a:a.length?a[0]:void 0},c.stopAutoSave=function(t){var e=this,o=t?Array.isArray(t)?t:[t]:this._models,n=[];return o.forEach(function(t){var o=e.saveReactionByCid.get(t.cid);o&&(o(),e.saveReactionByCid.delete(t.cid),n.push(t))}),n.length&&this.onStopAutoSave(n),!t||Array.isArray(t)?n:n.length?n[0]:void 0},c.onStopAutoSave=function(t){},c.onStartAutoSave=function(t){},c.destroy=function(){e.prototype.destroy.call(this),this.stopAutoSave()},c.autoSaveEnabled=function(t){return!!this.saveReactionByCid.get(t)},r}(e.Collection);
//# sourceMappingURL=autosave.js.map

var e=require("fast-deep-equal"),t=require("mobx"),n=require("nanoid/non-secure");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=/*#__PURE__*/o(e);function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a.apply(this,arguments)}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e,t,n){return f=l()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&u(r,n.prototype),r},f.apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return f(e,arguments,d(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)},h(e)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p=/*#__PURE__*/function(e){function t(t){var n;return(n=e.call(this,t)||this).name="Identity Error",n}return c(t,e),t}(/*#__PURE__*/h(Error)),m=/*#__PURE__*/function(){function e(){this.collection=void 0,this.cid=void 0,this.errors={save:null,delete:null},this._isDeleted=!1,this._isSaving=!1,this._isDeleting=!1,this.ignoreChange=!1,this._isDestroyed=!1,this.payloadActionDisposer=void 0,this.initialized=!1,this.pendingSaveCall=void 0,this.lastSavedData=void 0,this.cid=n.nanoid(),t.makeObservable(this,{init:t.action,_isDeleted:t.observable,isDeleted:t.computed,_isSaving:t.observable,isSaving:t.computed,_isDeleting:t.observable,isDeleting:t.computed,isDirty:t.computed,_isDestroyed:t.observable,isDestroyed:t.computed,isSyncing:t.computed,lastSavedData:t.observable,isNew:t.computed,computePayload:t.computed.struct,payload:t.computed,setIdentity:t.action,identity:t.computed,hasErrors:t.computed,errors:t.observable,saveError:t.computed,deleteError:t.computed,_onAdded:t.action,_onRemoved:t.action,_onSaveStart:t.action,_onSaveSuccess:t.action,_onSaveError:t.action,_onDeleteError:t.action,_onDeleteStart:t.action,_onDeleteSuccess:t.action,destroy:t.action})}var o=e.prototype;return o.init=function(){this.initialized||(this.payloadActionDisposer=this.startPayloadCompute(),this.lastSavedData=this.payload,this.initialized=!0)},o.startPayloadCompute=function(){var e=this;return t.autorun(function(){return e.payload})},o._onAdded=function(e,t){if(this.collection&&!t)throw new Error('Model can be in only one non "lite" collection');t||(this.collection=e),this.onAdded(e,t)},o.onAdded=function(e,t){},o._onRemoved=function(e,t){this.onRemoved(e,t),e===this.collection&&(this.collection=void 0)},o.onRemoved=function(e,t){},o._onSaveStart=function(e){var t=e.config,n=e.transportConfig,o=e.token;this._isSaving=!0,this.pendingSaveCall={token:o,state:"pending"},this.errors.save=void 0,this.onSaveStart({config:t,transportConfig:n})},o.onSaveStart=function(e){},o._onSaveSuccess=function(e){var t,n,o,r=e.response,i=e.config,s=e.transportConfig,a=e.token;if(a!==(null==(t=this.pendingSaveCall)?void 0:t.token)&&"pending"!==(null==(n=this.pendingSaveCall)?void 0:n.state)||(this.lastSavedData=e.savedData),a===(null==(o=this.pendingSaveCall)?void 0:o.token)&&(this._isSaving=!1,this.pendingSaveCall.state="resolved"),this.isNew&&this.constructor.setIdentityFromResponse){var c=this.extractIdentityValue(null==r?void 0:r.data,i,s);if(!c)throw new p("Can't set identity key: "+this.identityKey);this.setIdentity(c),this.lastSavedData[this.identityKey]=this.identity}this.onSaveSuccess({config:i,transportConfig:s,response:r})},o.onSaveSuccess=function(e){},o._onSaveError=function(e){var t,n=e.error,o=e.config,r=e.transportConfig,i=e.dataToSave;(null==(t=this.pendingSaveCall)?void 0:t.token)===e.token&&(this._isSaving=!1,this.errors.save=n,this.pendingSaveCall.state="rejected"),this.onSaveError({error:n,config:o,transportConfig:r,dataToSave:i})},o.onSaveError=function(e){},o.extractIdentityValue=function(e,t,n){return e&&e[this.identityKey]},o.setIdentity=function(e){this[this.identityKey]=e},o.modelIsNew=function(){return this.identity===this.cid||!this.identity},o._onDeleteStart=function(e){this._isDeleting=!0,this.onDeleteStart(e)},o.onDeleteStart=function(e){},o._onDeleteSuccess=function(e){this._isDeleting=!1,this.errors.delete=void 0,this._isDeleted=!0,this.onDeleteSuccess(e)},o.onDeleteSuccess=function(e){},o._onDeleteError=function(e){this.errors.delete=e.error,this._isDeleting=!1,this._isDeleted=!1,this.onDeleteError(e)},o.onDeleteError=function(e){},o.modelIsDirty=function(){return!r.default(this.lastSavedData,this.payload)},o.destroy=function(){this.onDestroy(),this._isDestroyed=!0,this.payloadActionDisposer()},o.onDestroy=function(){},s(e,[{key:"identityKey",get:function(){return this.constructor.identityKey}},{key:"payload",get:function(){return this.computePayload}},{key:"computePayload",get:function(){return this.serialize()}},{key:"hasErrors",get:function(){return!!this.errors.save||!!this.errors.delete}},{key:"saveError",get:function(){return this.errors.save}},{key:"deleteError",get:function(){return this.errors.delete}},{key:"isDeleted",get:function(){return this._isDeleted}},{key:"isSyncing",get:function(){return this.isSaving||this.isDeleting}},{key:"isDeleting",get:function(){return this._isDeleting}},{key:"isSaving",get:function(){return this._isSaving}},{key:"isDestroyed",get:function(){return this._isDestroyed}},{key:"identity",get:function(){return this[this.identityKey]}},{key:"isNew",get:function(){return this.modelIsNew()}},{key:"isDirty",get:function(){return this.modelIsDirty()}}]),e}();m.identityKey="cid",m.setIdentityFromResponse=!1;var g=["error"];function S(e){return Array.isArray(e)?[].concat(e):[e]}var b="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function _(e,t,n){if(!e.s){if(n instanceof E){if(!n.s)return void(n.o=_.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(_.bind(null,e,t),_.bind(null,e,2));e.s=t,e.v=n;var o=e.o;o&&o(e)}}var E=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var o=new e,r=this.s;if(r){var i=1&r?t:n;if(i){try{_(o,1,i(this.v))}catch(e){_(o,2,e)}return o}return this}return this.o=function(e){try{var r=e.v;1&e.s?_(o,1,t?t(r):r):n?_(o,1,n(r)):_(o,2,r)}catch(e){_(o,2,e)}},o},e}();function D(e){return e instanceof E&&1&e.s}var C=/*#__PURE__*/function(){function e(e,n){this.factory=void 0,this._models=[],this.modelByCid=new Map,this.modelByIdentity=new Map,this.config=void 0,this.identityReactionByCid=new Map,this.factory=e,this.config={add:a({insertPosition:"end"},null!=n&&n.add?n.add:void 0),remove:a({destroy:!1},null!=n&&n.remove?n.remove:void 0),reset:a({destroy:!1},null!=n&&n.reset?n.reset:void 0)},t.makeObservable(this,{add:t.action,_models:t.observable.shallow,modelByCid:t.observable.shallow,modelByIdentity:t.observable.shallow,addToCollection:t.action,removeFromCollection:t.action,destroy:t.action,syncing:t.computed,deleting:t.computed,saving:t.computed,new:t.computed,models:t.computed})}var n=e.prototype;return n.getConfig=function(){return this.config},n.assertIsModel=function(e){if(!m.prototype.isPrototypeOf(e))throw new Error("model is not instance of Model class")},n.push=function(e){return this.add(e)},n.add=function(e){return this.addToCollection(e,{insertPosition:"end"})},n.unshift=function(e){return this.addToCollection(e,{insertPosition:"start"})},n.addAtIndex=function(e,t){return this.addToCollection(e,{insertPosition:t})},n.addToCollection=function(e,t){for(var n,o,r=S(e),i=a({},this.config.add,t),s=[],c=y(r);!(n=c()).done;){var d=n.value;this.assertIsModel(d),this.notPresent(d)&&(s.push(d),this.startTracking(d),this.notifyAdded(d),this.onAdded(d))}if("end"===i.insertPosition)(o=this._models).push.apply(o,s);else if("start"===i.insertPosition){var u;(u=this._models).unshift.apply(u,s)}else{var l;if(i.insertPosition>this._models.length||i.insertPosition<0)throw new Error("insertion index out of bounds");(l=this._models).splice.apply(l,[i.insertPosition,0].concat(s))}return Array.isArray(e)?s:s[0]},n.notPresent=function(e){var t=!this.modelByCid.get(e.cid),n=!1,o=e.identity;return o&&(n=!!this.modelByIdentity.get(o)),t&&!n},n.startTracking=function(e){var n=this;this.modelByCid.set(e.cid,e);var o=e.identity;o&&this.modelByIdentity.set(o,e);var r=t.reaction(function(){return e.identity},function(t){n.modelByIdentity.set(t,e)},{name:"id-"+e.cid});this.identityReactionByCid.set(e.cid,r)},n.stopTracking=function(e){this.modelByCid.delete(e.cid),this.modelByIdentity.delete(e.identity);var t=this.identityReactionByCid.get(e.cid);t&&t()},n.resolveModel=function(e){return this.modelByIdentity.get(e)||this.modelByCid.get(e)},n.resolveModels=function(e){for(var t,n=[],o=y(S(e));!(t=o()).done;){var r=this.resolveModel(t.value);r&&n.push(r)}return n},n.create=function(e){var t,n=this.factory(e);return(t=n)instanceof Promise||function(e){return null!==e&&("object"==typeof e||"function"==typeof e)}(t)&&"function"==typeof t.then&&"function"==typeof t.catch?n.then(function(e){e.init()}):n.init(),n},n.getById=function(e){return Array.isArray(e)?this.resolveModels(e):this.resolveModel(e)},n.pop=function(e){if(this.models.length>0)return this.removeFromCollection(this.models[this.models.length-1],e)},n.shift=function(e){if(this.models.length>0)return this.removeFromCollection(this.models[0],e)},n.removeAtIndex=function(e,t){if(!(e<0||e>=this._models.length))return this.removeFromCollection(this._models[e],t)},n.remove=function(e,t){var n=this.resolveModels(e),o=n;if(!Array.isArray(e)){if(!n.length)return;o=o[0]}return this.removeFromCollection(o,t)},n.removeFromCollection=function(e,t){var n=this,o=new Set(S(e).map(function(e){return e.cid})),r=[],i=this._models.length,s=function(e){r.push(e),n.stopTracking(e),n.notifyRemoved(e),null!=t&&t.destroy&&e.destroy(),n.onRemoved(e)};if(1===o.size)for(var a=0;a<i;a++){var c=this._models[a];if(this.assertIsModel(c),o.has(c.cid)){this._models.splice(a,1),s(c);break}}else{for(var d=[],u=0;u<i;u++){var l=this._models[u];this.assertIsModel(l),o.has(l.cid)?s(l):d.push(l)}this._models=d}return Array.isArray(e)?r:r[0]},n.notifyRemoved=function(e){e._onRemoved(this,!0)},n.notifyAdded=function(e){e._onAdded(this,!0)},n.onRemoved=function(e){},n.onAdded=function(e){},n.serialize=function(){return a({models:this.serializeModels()},this.onSerialize())},n.serializeModels=function(){return this._models.reduce(function(e,t){var n=t.payload;return n&&e.push(n),e},[])},n.onSerialize=function(){},n.resetCollection=function(e,t){try{var n=function(){var e=o.removeFromCollection(o._models,t),n=o.addToCollection(i,{insertPosition:"end"});return o.onReset(n,e),[n,e]},o=this;if(!e){var r=o.removeFromCollection(o._models,t);return o.onReset([],r),Promise.resolve([[],r])}var i=[],s=function(e,t,n){if("function"==typeof e[b]){var o,r,i,s=e[b]();if(function e(n){try{for(;!(o=s.next()).done;)if((n=t(o.value))&&n.then){if(!D(n))return void n.then(e,i||(i=_.bind(null,r=new E,2)));n=n.v}r?_(r,1,n):r=n}catch(e){_(r||(r=new E),2,e)}}(),s.return){var a=function(e){try{o.done||s.return()}catch(e){}return e};if(r&&r.then)return r.then(a,function(e){throw a(e)});a()}return r}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],d=0;d<e.length;d++)c.push(e[d]);return function(e,t,n){var o,r,i=-1;return function n(s){try{for(;++i<e.length;)if((s=t(i))&&s.then){if(!D(s))return void s.then(n,r||(r=_.bind(null,o=new E,2)));s=s.v}o?_(o,1,s):o=s}catch(e){_(o||(o=new E),2,e)}}(),o}(c,function(e){return t(c[e])})}(e,function(e){var t=o.onModelCreateData(e);if(t)return Promise.resolve(o.factory(t)).then(function(e){i.push(e)})});return Promise.resolve(s&&s.then?s.then(n):n())}catch(e){return Promise.reject(e)}},n.reset=function(e,t){return this.resetCollection(e,t)},n.onReset=function(e,t){},n.onModelCreateData=function(e){return e},n.destroy=function(){var e=this;this.onDestroy(),this.identityReactionByCid.forEach(function(e){return e()}),this._models.forEach(function(t){e.notifyRemoved(t)})},n.onDestroy=function(){},s(e,[{key:"models",get:function(){return this._models}},{key:"new",get:function(){return this.models.filter(function(e){return e.isNew})}},{key:"deleted",get:function(){return this.models.filter(function(e){return e.isDeleted})}},{key:"syncing",get:function(){return this.deleting.concat(this.saving)}},{key:"deleting",get:function(){return this._models.filter(function(e){return e.isDeleting})}},{key:"saving",get:function(){return this._models.filter(function(e){return e.isSaving})}}]),e}();function w(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function P(e,t){try{var n=e()}catch(e){return t(!0,e)}return n&&n.then?n.then(t.bind(null,!1),t.bind(null,!0)):t(!1,n)}var I="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function k(e,t,n){if(!e.s){if(n instanceof O){if(!n.s)return void(n.o=k.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(k.bind(null,e,t),k.bind(null,e,2));e.s=t,e.v=n;var o=e.o;o&&o(e)}}var O=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var o=new e,r=this.s;if(r){var i=1&r?t:n;if(i){try{k(o,1,i(this.v))}catch(e){k(o,2,e)}return o}return this}return this.o=function(e){try{var r=e.v;1&e.s?k(o,1,t?t(r):r):n?k(o,1,n(r)):k(o,2,r)}catch(e){k(o,2,e)}},o},e}();function R(e){return e instanceof O&&1&e.s}var A=/*#__PURE__*/function(e){function n(n,o,r){var i;return(i=e.call(this,n,r)||this).transport=void 0,i.loadError=void 0,i.loadStatus="IDLE",i._deleting=new Map,i._saving=new Map,i.transport=o,i.config=a({},i.config,{save:a({insertPosition:"end",addImmediately:!0,addOnError:!0},null!=r&&r.save?r.save:void 0),delete:a({remove:!0,destroyOnRemoval:!0,removeImmediately:!0,removeOnError:!1},null!=r&&r.delete?r.delete:void 0),load:a({duplicateModelStrategy:"KEEP_NEW",compareFn:function(){return"KEEP_NEW"},insertPosition:"end",destroyOnRemoval:!0,reset:!1,destroyOnReset:!1},null!=r&&r.load?r.load:void 0)}),t.makeObservable(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),{save:t.action,delete:t.action,load:t.action,_saving:t.observable.shallow,_deleting:t.observable.shallow,onSaveStart:t.action,onSaveSuccess:t.action,onSaveError:t.action,onDeleteStart:t.action,onDeleteSuccess:t.action,onDeleteError:t.action,onLoadStart:t.action,onLoadSuccess:t.action,onLoadError:t.action,loadStatus:t.observable,loadError:t.observable}),i}c(n,e);var o=n.prototype;return o.getConfig=function(){return this.config},o.getTransport=function(){return this.transport},o.save=function(e,n,o){try{var r=this,i=a({},r.config.save,n);i.addImmediately?r.addToCollection(e,{insertPosition:i.insertPosition}):r.assertIsModel(e);var s={};t.runInAction(function(){r._saving.set(e.cid,{token:s,model:e})});var c=e.payload;return Promise.resolve(P(function(){return w(function(){return r.onSaveStart({model:e,config:i,transportConfig:o}),e._onSaveStart({config:i,transportConfig:o,token:s}),Promise.resolve(r.callTransportSave(e,o)).then(function(t){return i.addImmediately||r.addToCollection(e,{insertPosition:i.insertPosition}),r.onSaveSuccess({model:e,response:t,config:i,transportConfig:o}),e._onSaveSuccess({response:t,config:i,transportConfig:o,savedData:c,token:s}),{response:t,model:e,error:void 0}})},function(t){return t instanceof p||i.addImmediately||!i.addOnError||r.addToCollection(e,{insertPosition:i.insertPosition}),r.onSaveError({model:e,error:t,config:i,transportConfig:o}),e._onSaveError({error:t,config:i,transportConfig:o,token:s,dataToSave:c}),{error:t,model:void 0,response:void 0}})},function(n,o){var i=r._saving.get(e.cid);if((null==i?void 0:i.token)===s&&t.runInAction(function(){r._saving.delete(e.cid)}),n)throw o;return o}))}catch(e){return Promise.reject(e)}},o.callTransportSave=function(e,t){return this.transport.save(e,t)},o.callTransportDelete=function(e,t){return this.transport.delete(e,t)},o.callTransportLoad=function(e){return this.transport.load(e)},o.onSaveStart=function(e){},o.onSaveSuccess=function(e){},o.onSaveError=function(e){},o.delete=function(e,n,o){try{var r=this,i=a({},r.config.delete,n),s=r.resolveModel(e);try{r.modelCanBeDeleted(s)}catch(e){return Promise.resolve({error:e.message,response:void 0,model:void 0})}return i.remove&&i.removeImmediately&&r.removeFromCollection(s,{destroy:i.destroyOnRemoval}),Promise.resolve(P(function(){return w(function(){return r._deleting.set(s.cid,s),r.onDeleteStart({model:s,config:i,transportConfig:o}),s._onDeleteStart({config:i,transportConfig:o}),Promise.resolve(r.callTransportDelete(s,o)).then(function(e){return i.remove&&!i.removeImmediately&&r.removeFromCollection(s,{destroy:i.destroyOnRemoval}),r.onDeleteSuccess({model:s,response:e,config:i,transportConfig:o}),s._onDeleteSuccess({response:e,config:i,transportConfig:o}),{response:e,model:s,error:void 0}})},function(e){return i.remove&&!i.removeImmediately&&i.removeOnError&&r.removeFromCollection(s,{destroy:i.destroyOnRemoval}),r.onDeleteError({model:s,error:e,config:i,transportConfig:o}),s._onDeleteError({error:e,config:i,data:null==e?void 0:e.data,transportConfig:o}),{response:void 0,model:void 0,error:e}})},function(e,n){if(t.runInAction(function(){r._deleting.delete(s.cid)}),e)throw n;return n}))}catch(e){return Promise.reject(e)}},o.modelCanBeDeleted=function(e){if(this.assertModelIsExists(e),e.isDeleted)throw new Error("Model is deleted");if(e.isDeleting)throw new Error("Model is in the process of deleting")},o.assertModelIsExists=function(e){if(!e)throw new Error("Model is not in the collection")},o.onDeleteStart=function(e){},o.onDeleteSuccess=function(e){},o.onDeleteError=function(e){},o.load=function(e,n){try{var o=this;o.loadError=void 0;var r=a({},o.config.load,e);return Promise.resolve(w(function(){return o.loadStatus="PENDING",o.onLoadStart({config:r,transportConfig:n}),Promise.resolve(o.callTransportLoad(n)).then(function(e){var i;function s(t){if(i)return t;function s(t){var i=o.remove(c,{destroy:r.destroyOnRemoval}),s=o.addToCollection(a,{insertPosition:r.insertPosition});return o.onLoadSuccess({config:r,transportConfig:n,response:e,added:s,removed:i}),{response:e,added:s,removed:i,error:void 0}}var a=[],c=[],d=function(e,t,n){if("function"==typeof e[I]){var o,r,i,s=e[I]();if(function e(n){try{for(;!(o=s.next()).done;)if((n=t(o.value))&&n.then){if(!R(n))return void n.then(e,i||(i=k.bind(null,r=new O,2)));n=n.v}r?k(r,1,n):r=n}catch(e){k(r||(r=new O),2,e)}}(),s.return){var a=function(e){try{o.done||s.return()}catch(e){}return e};if(r&&r.then)return r.then(a,function(e){throw a(e)});a()}return r}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],d=0;d<e.length;d++)c.push(e[d]);return function(e,t,n){var o,r,i=-1;return function n(s){try{for(;++i<e.length;)if((s=t(i))&&s.then){if(!R(s))return void s.then(n,r||(r=k.bind(null,o=new O,2)));s=s.v}o?k(o,1,s):o=s}catch(e){k(o||(o=new O),2,e)}}(),o}(c,function(e){return t(c[e])})}(e.data,function(e){var t=o.onModelCreateData(e);if(t)return Promise.resolve(o.factory(t)).then(function(e){if(o.notPresent(e))a.push(e);else{var t=o.modelByIdentity.get(e.identity),n=r.compareFn(e,t);switch(r.duplicateModelStrategy){case"KEEP_NEW":c.push(t.cid),a.push(e);break;case"COMPARE":switch(n){case"KEEP_NEW":a.push(e),c.push(t.cid);break;case"KEEP_OLD":break;case"KEEP_BOTH":if(!o.notPresent(e))throw new Error("New model has a non unique identity");a.push(e);break;default:throw new Error("Invalid compare result")}}}})});return d&&d.then?d.then(s):s()}t.runInAction(function(){o.loadStatus="RESOLVED"});var a=function(){if(r.reset)return Promise.resolve(o.resetCollection(e.data,{destroy:r.destroyOnReset})).then(function(t){var s=t[0],a=t[1];return o.onLoadSuccess({config:r,transportConfig:n,response:e,added:s,removed:a}),i=1,{response:e,added:s,removed:a,error:void 0}})}();return a&&a.then?a.then(s):s(a)})},function(e){return t.runInAction(function(){o.loadError=e,o.loadStatus="REJECTED"}),o.onLoadError({config:r,transportConfig:n,error:e}),{error:e,response:void 0,added:void 0,removed:void 0}}))}catch(e){return Promise.reject(e)}},o.onLoadStart=function(e){},o.onLoadSuccess=function(e){},o.onLoadError=function(e){},o.notifyAdded=function(e){e._onAdded(this,!1)},o.notifyRemoved=function(e){e._onRemoved(this,!1)},o.destroy=function(){e.prototype.destroy.call(this),this._models.forEach(function(e){e.destroy()}),this._models=[]},s(n,[{key:"deleting",get:function(){return[].concat(this._deleting.values())}},{key:"saving",get:function(){var e=[];return this._saving.forEach(function(t){e.push(t.model)}),e}}]),n}(C),M=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.load=function(){return Promise.resolve({data:[]})},t.save=function(e){return Promise.resolve()},t.delete=function(){return Promise.resolve()},e}();exports.ASYNC_STATUS={PENDING:"PENDING",RESOLVED:"RESOLVED",REJECTED:"REJECTED",IDLE:"IDLE"},exports.Collection=A,exports.Model=m,exports.StubTransport=M,exports.unwrapResult=function(e){if(e.error)throw e.error;return function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t.indexOf(n=i[o])>=0||(r[n]=e[n]);return r}(e,g)};
//# sourceMappingURL=core.js.map

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fast-deep-equal"),require("mobx"),require("nanoid/non-secure")):"function"==typeof define&&define.amd?define(["exports","fast-deep-equal","mobx","nanoid/non-secure"],t):t((e||self).core={},e.fastDeepEqual,e.mobx,e.nanoid)}(this,function(e,t,n,o){function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=/*#__PURE__*/r(t);function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c.apply(this,arguments)}function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function h(e,t,n){return h=f()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&l(r,n.prototype),r},h.apply(null,arguments)}function v(e){var t="function"==typeof Map?new Map:void 0;return v=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return h(e,arguments,u(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,e)},v(e)}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var m=/*#__PURE__*/function(e){function t(t){var n;return(n=e.call(this,t)||this).name="Identity Error",n}return d(t,e),t}(/*#__PURE__*/v(Error)),g=/*#__PURE__*/function(){function e(){this.collection=void 0,this.cid=void 0,this.errors={save:null,delete:null},this._isDeleted=!1,this._isSaving=!1,this._isDeleting=!1,this.ignoreChange=!1,this._isDestroyed=!1,this.payloadActionDisposer=void 0,this.initialized=!1,this.pendingSaveCall=void 0,this.lastSavedData=void 0,this.cid=o.nanoid(),n.makeObservable(this,{init:n.action,_isDeleted:n.observable,isDeleted:n.computed,_isSaving:n.observable,isSaving:n.computed,_isDeleting:n.observable,isDeleting:n.computed,isDirty:n.computed,_isDestroyed:n.observable,isDestroyed:n.computed,isSyncing:n.computed,lastSavedData:n.observable,isNew:n.computed,computePayload:n.computed.struct,payload:n.computed,setIdentity:n.action,identity:n.computed,hasErrors:n.computed,errors:n.observable,saveError:n.computed,deleteError:n.computed,_onAdded:n.action,_onRemoved:n.action,_onSaveStart:n.action,_onSaveSuccess:n.action,_onSaveError:n.action,_onDeleteError:n.action,_onDeleteStart:n.action,_onDeleteSuccess:n.action,destroy:n.action})}var t=e.prototype;return t.init=function(){this.initialized||(this.payloadActionDisposer=this.startPayloadCompute(),this.lastSavedData=this.payload,this.initialized=!0)},t.startPayloadCompute=function(){var e=this;return n.autorun(function(){return e.payload})},t._onAdded=function(e,t){if(this.collection&&!t)throw new Error('Model can be in only one non "lite" collection');t||(this.collection=e),this.onAdded(e,t)},t.onAdded=function(e,t){},t._onRemoved=function(e,t){this.onRemoved(e,t),e===this.collection&&(this.collection=void 0)},t.onRemoved=function(e,t){},t._onSaveStart=function(e){var t=e.config,n=e.transportConfig,o=e.token;this._isSaving=!0,this.pendingSaveCall={token:o,state:"pending"},this.errors.save=void 0,this.onSaveStart({config:t,transportConfig:n})},t.onSaveStart=function(e){},t._onSaveSuccess=function(e){var t,n,o,r=e.response,i=e.config,s=e.transportConfig,a=e.token;if(a!==(null==(t=this.pendingSaveCall)?void 0:t.token)&&"pending"!==(null==(n=this.pendingSaveCall)?void 0:n.state)||(this.lastSavedData=e.savedData),a===(null==(o=this.pendingSaveCall)?void 0:o.token)&&(this._isSaving=!1,this.pendingSaveCall.state="resolved"),this.isNew&&this.constructor.setIdentityFromResponse){var c=this.extractIdentityValue(null==r?void 0:r.data,i,s);if(!c)throw new m("Can't set identity key: "+this.identityKey);this.setIdentity(c),this.lastSavedData[this.identityKey]=this.identity}this.onSaveSuccess({config:i,transportConfig:s,response:r})},t.onSaveSuccess=function(e){},t._onSaveError=function(e){var t,n=e.error,o=e.config,r=e.transportConfig,i=e.dataToSave;(null==(t=this.pendingSaveCall)?void 0:t.token)===e.token&&(this._isSaving=!1,this.errors.save=n,this.pendingSaveCall.state="rejected"),this.onSaveError({error:n,config:o,transportConfig:r,dataToSave:i})},t.onSaveError=function(e){},t.extractIdentityValue=function(e,t,n){return e&&e[this.identityKey]},t.setIdentity=function(e){this[this.identityKey]=e},t.modelIsNew=function(){return this.identity===this.cid||!this.identity},t._onDeleteStart=function(e){this._isDeleting=!0,this.onDeleteStart(e)},t.onDeleteStart=function(e){},t._onDeleteSuccess=function(e){this._isDeleting=!1,this.errors.delete=void 0,this._isDeleted=!0,this.onDeleteSuccess(e)},t.onDeleteSuccess=function(e){},t._onDeleteError=function(e){this.errors.delete=e.error,this._isDeleting=!1,this._isDeleted=!1,this.onDeleteError(e)},t.onDeleteError=function(e){},t.modelIsDirty=function(){return!i.default(this.lastSavedData,this.payload)},t.destroy=function(){this.onDestroy(),this._isDestroyed=!0,this.payloadActionDisposer()},t.onDestroy=function(){},a(e,[{key:"identityKey",get:function(){return this.constructor.identityKey}},{key:"payload",get:function(){return this.computePayload}},{key:"computePayload",get:function(){return this.serialize()}},{key:"hasErrors",get:function(){return!!this.errors.save||!!this.errors.delete}},{key:"saveError",get:function(){return this.errors.save}},{key:"deleteError",get:function(){return this.errors.delete}},{key:"isDeleted",get:function(){return this._isDeleted}},{key:"isSyncing",get:function(){return this.isSaving||this.isDeleting}},{key:"isDeleting",get:function(){return this._isDeleting}},{key:"isSaving",get:function(){return this._isSaving}},{key:"isDestroyed",get:function(){return this._isDestroyed}},{key:"identity",get:function(){return this[this.identityKey]}},{key:"isNew",get:function(){return this.modelIsNew()}},{key:"isDirty",get:function(){return this.modelIsDirty()}}]),e}();g.identityKey="cid",g.setIdentityFromResponse=!1;var S=["error"];function b(e){return Array.isArray(e)?[].concat(e):[e]}var _="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function E(e,t,n){if(!e.s){if(n instanceof D){if(!n.s)return void(n.o=E.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(E.bind(null,e,t),E.bind(null,e,2));e.s=t,e.v=n;var o=e.o;o&&o(e)}}var D=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var o=new e,r=this.s;if(r){var i=1&r?t:n;if(i){try{E(o,1,i(this.v))}catch(e){E(o,2,e)}return o}return this}return this.o=function(e){try{var r=e.v;1&e.s?E(o,1,t?t(r):r):n?E(o,1,n(r)):E(o,2,r)}catch(e){E(o,2,e)}},o},e}();function C(e){return e instanceof D&&1&e.s}var w=/*#__PURE__*/function(){function e(e,t){this.factory=void 0,this._models=[],this.modelByCid=new Map,this.modelByIdentity=new Map,this.config=void 0,this.identityReactionByCid=new Map,this.factory=e,this.config={add:c({insertPosition:"end"},null!=t&&t.add?t.add:void 0),remove:c({destroy:!1},null!=t&&t.remove?t.remove:void 0),reset:c({destroy:!1},null!=t&&t.reset?t.reset:void 0)},n.makeObservable(this,{add:n.action,_models:n.observable.shallow,modelByCid:n.observable.shallow,modelByIdentity:n.observable.shallow,addToCollection:n.action,removeFromCollection:n.action,destroy:n.action,syncing:n.computed,deleting:n.computed,saving:n.computed,new:n.computed,models:n.computed})}var t=e.prototype;return t.getConfig=function(){return this.config},t.assertIsModel=function(e){if(!g.prototype.isPrototypeOf(e))throw new Error("model is not instance of Model class")},t.push=function(e){return this.add(e)},t.add=function(e){return this.addToCollection(e,{insertPosition:"end"})},t.unshift=function(e){return this.addToCollection(e,{insertPosition:"start"})},t.addAtIndex=function(e,t){return this.addToCollection(e,{insertPosition:t})},t.addToCollection=function(e,t){for(var n,o,r=b(e),i=c({},this.config.add,t),s=[],a=p(r);!(n=a()).done;){var d=n.value;this.assertIsModel(d),this.notPresent(d)&&(s.push(d),this.startTracking(d),this.notifyAdded(d),this.onAdded(d))}if("end"===i.insertPosition)(o=this._models).push.apply(o,s);else if("start"===i.insertPosition){var u;(u=this._models).unshift.apply(u,s)}else{var l;if(i.insertPosition>this._models.length||i.insertPosition<0)throw new Error("insertion index out of bounds");(l=this._models).splice.apply(l,[i.insertPosition,0].concat(s))}return Array.isArray(e)?s:s[0]},t.notPresent=function(e){var t=!this.modelByCid.get(e.cid),n=!1,o=e.identity;return o&&(n=!!this.modelByIdentity.get(o)),t&&!n},t.startTracking=function(e){var t=this;this.modelByCid.set(e.cid,e);var o=e.identity;o&&this.modelByIdentity.set(o,e);var r=n.reaction(function(){return e.identity},function(n){t.modelByIdentity.set(n,e)},{name:"id-"+e.cid});this.identityReactionByCid.set(e.cid,r)},t.stopTracking=function(e){this.modelByCid.delete(e.cid),this.modelByIdentity.delete(e.identity);var t=this.identityReactionByCid.get(e.cid);t&&t()},t.resolveModel=function(e){return this.modelByIdentity.get(e)||this.modelByCid.get(e)},t.resolveModels=function(e){for(var t,n=[],o=p(b(e));!(t=o()).done;){var r=this.resolveModel(t.value);r&&n.push(r)}return n},t.create=function(e){var t,n=this.factory(e);return(t=n)instanceof Promise||function(e){return null!==e&&("object"==typeof e||"function"==typeof e)}(t)&&"function"==typeof t.then&&"function"==typeof t.catch?n.then(function(e){e.init()}):n.init(),n},t.getById=function(e){return Array.isArray(e)?this.resolveModels(e):this.resolveModel(e)},t.pop=function(e){if(this.models.length>0)return this.removeFromCollection(this.models[this.models.length-1],e)},t.shift=function(e){if(this.models.length>0)return this.removeFromCollection(this.models[0],e)},t.removeAtIndex=function(e,t){if(!(e<0||e>=this._models.length))return this.removeFromCollection(this._models[e],t)},t.remove=function(e,t){var n=this.resolveModels(e),o=n;if(!Array.isArray(e)){if(!n.length)return;o=o[0]}return this.removeFromCollection(o,t)},t.removeFromCollection=function(e,t){var n=this,o=new Set(b(e).map(function(e){return e.cid})),r=[],i=this._models.length,s=function(e){r.push(e),n.stopTracking(e),n.notifyRemoved(e),null!=t&&t.destroy&&e.destroy(),n.onRemoved(e)};if(1===o.size)for(var a=0;a<i;a++){var c=this._models[a];if(this.assertIsModel(c),o.has(c.cid)){this._models.splice(a,1),s(c);break}}else{for(var d=[],u=0;u<i;u++){var l=this._models[u];this.assertIsModel(l),o.has(l.cid)?s(l):d.push(l)}this._models=d}return Array.isArray(e)?r:r[0]},t.notifyRemoved=function(e){e._onRemoved(this,!0)},t.notifyAdded=function(e){e._onAdded(this,!0)},t.onRemoved=function(e){},t.onAdded=function(e){},t.serialize=function(){return c({models:this.serializeModels()},this.onSerialize())},t.serializeModels=function(){return this._models.reduce(function(e,t){var n=t.payload;return n&&e.push(n),e},[])},t.onSerialize=function(){},t.resetCollection=function(e,t){try{var n=function(){var e=o.removeFromCollection(o._models,t),n=o.addToCollection(i,{insertPosition:"end"});return o.onReset(n,e),[n,e]},o=this;if(!e){var r=o.removeFromCollection(o._models,t);return o.onReset([],r),Promise.resolve([[],r])}var i=[],s=function(e,t,n){if("function"==typeof e[_]){var o,r,i,s=e[_]();if(function e(n){try{for(;!(o=s.next()).done;)if((n=t(o.value))&&n.then){if(!C(n))return void n.then(e,i||(i=E.bind(null,r=new D,2)));n=n.v}r?E(r,1,n):r=n}catch(e){E(r||(r=new D),2,e)}}(),s.return){var a=function(e){try{o.done||s.return()}catch(e){}return e};if(r&&r.then)return r.then(a,function(e){throw a(e)});a()}return r}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],d=0;d<e.length;d++)c.push(e[d]);return function(e,t,n){var o,r,i=-1;return function n(s){try{for(;++i<e.length;)if((s=t(i))&&s.then){if(!C(s))return void s.then(n,r||(r=E.bind(null,o=new D,2)));s=s.v}o?E(o,1,s):o=s}catch(e){E(o||(o=new D),2,e)}}(),o}(c,function(e){return t(c[e])})}(e,function(e){var t=o.onModelCreateData(e);if(t)return Promise.resolve(o.factory(t)).then(function(e){i.push(e)})});return Promise.resolve(s&&s.then?s.then(n):n())}catch(e){return Promise.reject(e)}},t.reset=function(e,t){return this.resetCollection(e,t)},t.onReset=function(e,t){},t.onModelCreateData=function(e){return e},t.destroy=function(){var e=this;this.onDestroy(),this.identityReactionByCid.forEach(function(e){return e()}),this._models.forEach(function(t){e.notifyRemoved(t)})},t.onDestroy=function(){},a(e,[{key:"models",get:function(){return this._models}},{key:"new",get:function(){return this.models.filter(function(e){return e.isNew})}},{key:"deleted",get:function(){return this.models.filter(function(e){return e.isDeleted})}},{key:"syncing",get:function(){return this.deleting.concat(this.saving)}},{key:"deleting",get:function(){return this._models.filter(function(e){return e.isDeleting})}},{key:"saving",get:function(){return this._models.filter(function(e){return e.isSaving})}}]),e}();function P(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function I(e,t){try{var n=e()}catch(e){return t(!0,e)}return n&&n.then?n.then(t.bind(null,!1),t.bind(null,!0)):t(!1,n)}var k="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function O(e,t,n){if(!e.s){if(n instanceof R){if(!n.s)return void(n.o=O.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(O.bind(null,e,t),O.bind(null,e,2));e.s=t,e.v=n;var o=e.o;o&&o(e)}}var R=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var o=new e,r=this.s;if(r){var i=1&r?t:n;if(i){try{O(o,1,i(this.v))}catch(e){O(o,2,e)}return o}return this}return this.o=function(e){try{var r=e.v;1&e.s?O(o,1,t?t(r):r):n?O(o,1,n(r)):O(o,2,r)}catch(e){O(o,2,e)}},o},e}();function A(e){return e instanceof R&&1&e.s}var T=/*#__PURE__*/function(e){function t(t,o,r){var i;return(i=e.call(this,t,r)||this).transport=void 0,i.loadError=void 0,i.loadStatus="IDLE",i._deleting=new Map,i._saving=new Map,i.transport=o,i.config=c({},i.config,{save:c({insertPosition:"end",addImmediately:!0,addOnError:!0},null!=r&&r.save?r.save:void 0),delete:c({remove:!0,destroyOnRemoval:!0,removeImmediately:!0,removeOnError:!1},null!=r&&r.delete?r.delete:void 0),load:c({duplicateModelStrategy:"KEEP_NEW",compareFn:function(){return"KEEP_NEW"},insertPosition:"end",destroyOnRemoval:!0,reset:!1,destroyOnReset:!1},null!=r&&r.load?r.load:void 0)}),n.makeObservable(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),{save:n.action,delete:n.action,load:n.action,_saving:n.observable.shallow,_deleting:n.observable.shallow,onSaveStart:n.action,onSaveSuccess:n.action,onSaveError:n.action,onDeleteStart:n.action,onDeleteSuccess:n.action,onDeleteError:n.action,onLoadStart:n.action,onLoadSuccess:n.action,onLoadError:n.action,loadStatus:n.observable,loadError:n.observable}),i}d(t,e);var o=t.prototype;return o.getConfig=function(){return this.config},o.getTransport=function(){return this.transport},o.save=function(e,t,o){try{var r=this,i=c({},r.config.save,t);i.addImmediately?r.addToCollection(e,{insertPosition:i.insertPosition}):r.assertIsModel(e);var s={};n.runInAction(function(){r._saving.set(e.cid,{token:s,model:e})});var a=e.payload;return Promise.resolve(I(function(){return P(function(){return r.onSaveStart({model:e,config:i,transportConfig:o}),e._onSaveStart({config:i,transportConfig:o,token:s}),Promise.resolve(r.callTransportSave(e,o)).then(function(t){return i.addImmediately||r.addToCollection(e,{insertPosition:i.insertPosition}),r.onSaveSuccess({model:e,response:t,config:i,transportConfig:o}),e._onSaveSuccess({response:t,config:i,transportConfig:o,savedData:a,token:s}),{response:t,model:e,error:void 0}})},function(t){return t instanceof m||i.addImmediately||!i.addOnError||r.addToCollection(e,{insertPosition:i.insertPosition}),r.onSaveError({model:e,error:t,config:i,transportConfig:o}),e._onSaveError({error:t,config:i,transportConfig:o,token:s,dataToSave:a}),{error:t,model:void 0,response:void 0}})},function(t,o){var i=r._saving.get(e.cid);if((null==i?void 0:i.token)===s&&n.runInAction(function(){r._saving.delete(e.cid)}),t)throw o;return o}))}catch(e){return Promise.reject(e)}},o.callTransportSave=function(e,t){return this.transport.save(e,t)},o.callTransportDelete=function(e,t){return this.transport.delete(e,t)},o.callTransportLoad=function(e){return this.transport.load(e)},o.onSaveStart=function(e){},o.onSaveSuccess=function(e){},o.onSaveError=function(e){},o.delete=function(e,t,o){try{var r=this,i=c({},r.config.delete,t),s=r.resolveModel(e);try{r.modelCanBeDeleted(s)}catch(e){return Promise.resolve({error:e.message,response:void 0,model:void 0})}return i.remove&&i.removeImmediately&&r.removeFromCollection(s,{destroy:i.destroyOnRemoval}),Promise.resolve(I(function(){return P(function(){return r._deleting.set(s.cid,s),r.onDeleteStart({model:s,config:i,transportConfig:o}),s._onDeleteStart({config:i,transportConfig:o}),Promise.resolve(r.callTransportDelete(s,o)).then(function(e){return i.remove&&!i.removeImmediately&&r.removeFromCollection(s,{destroy:i.destroyOnRemoval}),r.onDeleteSuccess({model:s,response:e,config:i,transportConfig:o}),s._onDeleteSuccess({response:e,config:i,transportConfig:o}),{response:e,model:s,error:void 0}})},function(e){return i.remove&&!i.removeImmediately&&i.removeOnError&&r.removeFromCollection(s,{destroy:i.destroyOnRemoval}),r.onDeleteError({model:s,error:e,config:i,transportConfig:o}),s._onDeleteError({error:e,config:i,data:null==e?void 0:e.data,transportConfig:o}),{response:void 0,model:void 0,error:e}})},function(e,t){if(n.runInAction(function(){r._deleting.delete(s.cid)}),e)throw t;return t}))}catch(e){return Promise.reject(e)}},o.modelCanBeDeleted=function(e){if(this.assertModelIsExists(e),e.isDeleted)throw new Error("Model is deleted");if(e.isDeleting)throw new Error("Model is in the process of deleting")},o.assertModelIsExists=function(e){if(!e)throw new Error("Model is not in the collection")},o.onDeleteStart=function(e){},o.onDeleteSuccess=function(e){},o.onDeleteError=function(e){},o.load=function(e,t){try{var o=this;o.loadError=void 0;var r=c({},o.config.load,e);return Promise.resolve(P(function(){return o.loadStatus="PENDING",o.onLoadStart({config:r,transportConfig:t}),Promise.resolve(o.callTransportLoad(t)).then(function(e){var i;function s(n){if(i)return n;function s(n){var i=o.remove(c,{destroy:r.destroyOnRemoval}),s=o.addToCollection(a,{insertPosition:r.insertPosition});return o.onLoadSuccess({config:r,transportConfig:t,response:e,added:s,removed:i}),{response:e,added:s,removed:i,error:void 0}}var a=[],c=[],d=function(e,t,n){if("function"==typeof e[k]){var o,r,i,s=e[k]();if(function e(n){try{for(;!(o=s.next()).done;)if((n=t(o.value))&&n.then){if(!A(n))return void n.then(e,i||(i=O.bind(null,r=new R,2)));n=n.v}r?O(r,1,n):r=n}catch(e){O(r||(r=new R),2,e)}}(),s.return){var a=function(e){try{o.done||s.return()}catch(e){}return e};if(r&&r.then)return r.then(a,function(e){throw a(e)});a()}return r}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],d=0;d<e.length;d++)c.push(e[d]);return function(e,t,n){var o,r,i=-1;return function n(s){try{for(;++i<e.length;)if((s=t(i))&&s.then){if(!A(s))return void s.then(n,r||(r=O.bind(null,o=new R,2)));s=s.v}o?O(o,1,s):o=s}catch(e){O(o||(o=new R),2,e)}}(),o}(c,function(e){return t(c[e])})}(e.data,function(e){var t=o.onModelCreateData(e);if(t)return Promise.resolve(o.factory(t)).then(function(e){if(o.notPresent(e))a.push(e);else{var t=o.modelByIdentity.get(e.identity),n=r.compareFn(e,t);switch(r.duplicateModelStrategy){case"KEEP_NEW":c.push(t.cid),a.push(e);break;case"COMPARE":switch(n){case"KEEP_NEW":a.push(e),c.push(t.cid);break;case"KEEP_OLD":break;case"KEEP_BOTH":if(!o.notPresent(e))throw new Error("New model has a non unique identity");a.push(e);break;default:throw new Error("Invalid compare result")}}}})});return d&&d.then?d.then(s):s()}n.runInAction(function(){o.loadStatus="RESOLVED"});var a=function(){if(r.reset)return Promise.resolve(o.resetCollection(e.data,{destroy:r.destroyOnReset})).then(function(n){var s=n[0],a=n[1];return o.onLoadSuccess({config:r,transportConfig:t,response:e,added:s,removed:a}),i=1,{response:e,added:s,removed:a,error:void 0}})}();return a&&a.then?a.then(s):s(a)})},function(e){return n.runInAction(function(){o.loadError=e,o.loadStatus="REJECTED"}),o.onLoadError({config:r,transportConfig:t,error:e}),{error:e,response:void 0,added:void 0,removed:void 0}}))}catch(e){return Promise.reject(e)}},o.onLoadStart=function(e){},o.onLoadSuccess=function(e){},o.onLoadError=function(e){},o.notifyAdded=function(e){e._onAdded(this,!1)},o.notifyRemoved=function(e){e._onRemoved(this,!1)},o.destroy=function(){e.prototype.destroy.call(this),this._models.forEach(function(e){e.destroy()}),this._models=[]},a(t,[{key:"deleting",get:function(){return[].concat(this._deleting.values())}},{key:"saving",get:function(){var e=[];return this._saving.forEach(function(t){e.push(t.model)}),e}}]),t}(w),M=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.load=function(){return Promise.resolve({data:[]})},t.save=function(e){return Promise.resolve()},t.delete=function(){return Promise.resolve()},e}();e.ASYNC_STATUS={PENDING:"PENDING",RESOLVED:"RESOLVED",REJECTED:"REJECTED",IDLE:"IDLE"},e.Collection=T,e.Model=g,e.StubTransport=M,e.unwrapResult=function(e){if(e.error)throw e.error;return function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t.indexOf(n=i[o])>=0||(r[n]=e[n]);return r}(e,S)}});
//# sourceMappingURL=core.umd.js.map
